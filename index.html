<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Platform Jumper (Phaser)</title>
  <style>
    :root{--bg:#0f1724;--text:#e6eef8}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#071228;color:var(--text)}
    #game-container{width:420px;margin:24px auto;}
    .ui{display:flex;justify-content:space-between;align-items:center;margin:8px 0;color:var(--text)}
    button{background:#2b6cb0;border:0;padding:8px 12px;border-radius:8px;color:white;font-weight:600}
    input{padding:6px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.08);background:transparent;color:var(--text)}
    footer{margin-top:12px;text-align:center;color:#98a2b3;font-size:13px}
  </style>
</head>
<body>
  <div id="game-container">
    <div class="ui">
      <div>Score: <span id="score">0</span></div>
      <div><button id="toggle-sound">Toggle Sound</button></div>
    </div>
    <div id="phaser-game"></div>
    <div class="ui">
      <div>Controls: ← → to move · Z to jump · X to boost</div>
    </div>

    <footer>© 2025 Platform Jumper | Created by Kevin Cordova</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>

  <script>
  const configGame = {
    type: Phaser.AUTO,
    width: 400,
    height: 640,
    parent: 'phaser-game',
    backgroundColor: '#071228',
    physics: { default: 'arcade', arcade: { gravity: { y: 1000 }, debug: false } },
    scene: { preload, create, update }
  };

  let game = new Phaser.Game(configGame);
  let cursors, player, platformsGroup, score = 0, scoreTextEl;
  let canDoubleJump = false, hasDoubleJump = false, speedBoost = 1, boostTimer = 0, musicOn = true;

  function preload(){ }

  function create(){
    this.cameras.main.setBackgroundColor('#071228');

    platformsGroup = this.physics.add.staticGroup();
    createInitialPlatforms(this);

    player = this.add.rectangle(200, 520, 36, 36, 0xffd166);
    this.physics.add.existing(player);
    player.body.setSize(36,36);
    player.body.setCollideWorldBounds(false);
    player.setBounce?.(0);

    this.physics.add.collider(player, platformsGroup, onPlayerPlatform, null, this);

    cursors = this.input.keyboard.addKeys({
      left: Phaser.Input.Keyboard.KeyCodes.LEFT,
      right: Phaser.Input.Keyboard.KeyCodes.RIGHT,
      jump: Phaser.Input.Keyboard.KeyCodes.Z,
      boost: Phaser.Input.Keyboard.KeyCodes.X
    });

    scoreTextEl = document.getElementById('score');
    scoreTextEl.textContent = score;

    this.time.addEvent({ delay: 1500, callback: () => spawnPlatform(this), loop: true });

    this.soundVolume = 0.6;
    setupAudio(this);

    this.input.keyboard.on('keydown-Z', ()=>{
      if(player.body.touching.down){
        player.body.setVelocityY(-480);
        hasDoubleJump = true;
        playSfx('jump');
      } else if(hasDoubleJump && canDoubleJump){
        player.body.setVelocityY(-420);
        hasDoubleJump = false;
        playSfx('double');
      }
    });

    this.input.keyboard.on('keydown-X', ()=>{
      if(speedBoost === 1 && boostTimer<=0){
        speedBoost = 1.8;
        boostTimer = 180;
        playSfx('boost');
      }
    });

    document.getElementById('toggle-sound').addEventListener('click', ()=>{
      musicOn = !musicOn;
      toggleMusic(musicOn);
    });
  }

  function update(time, delta){
    const left = cursors.left.isDown;
    const right = cursors.right.isDown;
    const vx = 200 * speedBoost;

    if(left) player.body.setVelocityX(-vx);
    else if(right) player.body.setVelocityX(vx);
    else player.body.setVelocityX(0);

    platformsGroup.getChildren().forEach(p => {
      if(p.moving){
        p.x += p.vx * delta/16;
        p.refreshBody();
        if(p.x < p.minX || p.x > p.maxX) p.vx *= -1;
      }
      if(p.y > 720) p.destroy();
    });

    if(player.y < 220){
      const dy = Math.min((220 - player.y) * 0.2, 10);
      player.y += dy;
      platformsGroup.getChildren().forEach(p => {
        p.y += dy;
        p.refreshBody();
      });
      addScore(Math.round(dy));
    }

    if(score > 500 && Math.random() < 0.01) spawnMovingPlatform(this);

    if(boostTimer>0){
      boostTimer -= 1;
      if(boostTimer<=0) speedBoost = 1;
    }

    platformsGroup.getChildren().forEach(p => {
      p.displayWidth = Math.max(40, p.displayWidth - score*0.00005);
    });

    if(player.y > 720) this.physics.pause();
  }

  function createInitialPlatforms(scene){
    const base = scene.add.rectangle(200, 600, 120, 12, 0x63ace5);
    scene.physics.add.existing(base, true);
    platformsGroup.add(base);
    for(let i=0;i<7;i++) spawnPlatform(scene, 520 - i*80);
  }

  function spawnPlatform(scene, y = null){
    const yy = y !== null ? y : -20;
    const w = Phaser.Math.Between(60, 120);
    const x = Phaser.Math.Between(w/2, 400 - w/2);
    const rect = scene.add.rectangle(x, yy, w, 12, 0x63ace5);
    scene.physics.add.existing(rect, true);
    rect.displayWidth = w;
    rect.moving = false;
    platformsGroup.add(rect);
  }

  function spawnMovingPlatform(scene, y = -20){
    const w = Phaser.Math.Between(70, 120);
    const x = Phaser.Math.Between(w/2, 400 - w/2);
    const rect = scene.add.rectangle(x, y, w, 12, 0x63ace5);
    scene.physics.add.existing(rect, true);
    rect.displayWidth = w;
    rect.moving = true;
    rect.vx = Phaser.Math.FloatBetween(0.3, 1.2) * (Math.random()<0.5?-1:1);
    rect.minX = 20;
    rect.maxX = 380;
    platformsGroup.add(rect);
  }

  function onPlayerPlatform(ply, plat){
    if(ply.body.velocity.y > 0) ply.body.setVelocityY(0);
  }

  function addScore(n){
    score += n;
    scoreTextEl.textContent = score;
  }

  let audioCtx, sfxGain, musicOsc;
  function setupAudio(){
    try{
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      sfxGain = audioCtx.createGain();
      sfxGain.gain.value = 0.03;
      sfxGain.connect(audioCtx.destination);

      musicOsc = audioCtx.createOscillator();
      const musicGain = audioCtx.createGain();
      musicGain.gain.value = 0.0015;
      musicOsc.type = 'sine';
      musicOsc.frequency.value = 220;
      musicOsc.connect(musicGain);
      musicGain.connect(audioCtx.destination);
      musicOsc.start();
      toggleMusic(musicOn);
    }catch(e){ audioCtx = null; }
  }

  function toggleMusic(on){
    if(!audioCtx) return;
    if(on) audioCtx.resume();
    else audioCtx.suspend();
  }

  function playSfx(type){
    if(!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'square';

    if(type==='jump'){ o.frequency.value = 880; g.gain.value = 0.02; }
    else if(type==='double'){ o.frequency.value = 660; g.gain.value = 0.02; }
    else if(type==='power'){ o.frequency.value = 440; g.gain.value = 0.03; }
    else if(type==='boost'){ o.frequency.value = 1200; g.gain.value = 0.03; }

    o.connect(g);
    g.connect(audioCtx.destination);
    o.start();
    o.stop(audioCtx.currentTime + 0.08);
  }
  </script>
</body>
</html>






